lty = 3,
lwd = 1,
border = "gray96",
add = TRUE
)
}
cartoSansBoucle("OP", "2020")
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(2,2,4,2))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(2,2,8,2))
cartoSansBoucle(j, i)
dev.off()
}
}
plot(dpt$geom)
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,0,8,0))
cartoSansBoucle(j, i)
dev.off()
}
}
plot(dpt$geom)
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,8,0,0))
cartoSansBoucle(j, i)
dev.off()
}
}
plot(dpt$geom)
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,0,0,8))
cartoSansBoucle(j, i)
dev.off()
}
}
plot(dpt$geom)
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(8,0,0,0))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,8,0,0))
cartoSansBoucle(j, i)
dev.off()
}
}
plot(dpt$geom)
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,0,8,0))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,0,0,4))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,0,0,1.2))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(2,2,2,1.2))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(2,2,2,2))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(2,2,1.2,2))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,2,1.2,2))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,0,1.2,2))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,0,1.2,0))
cartoSansBoucle(j, i)
dev.off()
}
}
cartoSansBoucle <- function(culture, annee) {
sel <- data[data$annee == annee & data$culture == culture,]
# parametres couleurs
colCulture <-  unlist(lcouleurs [culture]  )
#par(mar = c(0, 0, 1.2, 0))
#centrage sur l'ensemble de la France
ghostLayer(dpt$geom, bg = "white")
choroLayer(
sel,
var =  "surface",
method = "jenks",
nclass = 5,
col = carto.pal(pal1 = colCulture, 5),
border = NA,
legend.title.cex = 0.6,
legend.values.cex = 0.5,
legend.title.txt = "Aire (ha)",
legend.border = "gray96",
legend.pos = "left",
add = TRUE
)
layoutLayer(
title = paste0(culture, " - ", annee),
tabtitle = TRUE,
theme = colCulture,
frame = FALSE,
postitle = "center",
author = "Arvalis, 2021",
sources = "Agreste, IGN",
posscale = "bottomright",
horiz = TRUE
)
plot(
dpt$geom,
col = NA,
lty = 3,
lwd = 1,
border = "gray96",
add = TRUE
)
}
cartoSansBoucle("OP", "2020")
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,0,1.2,0))
cartoSansBoucle(j, i)
dev.off()
}
}
library(sf)
library(cartography)
cheminW <-  paste0(Sys.getenv("oneDrive"), "\\data sauve\\")
cheminL <- "../../00_DATA/"
chemin <- ifelse( Sys.getenv("DESKTOP_SESSION") == "ubuntu", cheminL, cheminW)
nomfic <-  paste0(chemin,"ign.gpkg")
dpt <- st_read(nomfic, "dptCorse", quiet = TRUE, stringsAsFactors = F)
# A RETROUIVER
dptS <-  st_read("../dataE/00_ADMIN/contours-geographiques-tres-simplifies-des-departements-2019.geojson")
# PB dans le st_read le fichier se transforme
fr <-  st_read(nomfic, "france", quiet = TRUE, stringsAsFactors = F)
# assemblage
noms <- list.files("../data/",pattern = ".csv")
data <- NULL
i <- 1
for (i in 1:length(noms)){
tmp <- read.csv(paste0("../data/",noms [i]), skip = 3, header = FALSE, fill = TRUE)
# impossible d'importer la ligne de titre (accent de année)
data <- rbind(data,tmp)
}
names(data) <-  c("dpt", "surface", "culture","S", "annee")
data <- data [,-4]
# le champs S pas nécessaire
# champs culture
code <- sort(table(data$culture))
knitr::kable(code)
data [grep ("CORSE",data$dpt),]
write.csv(data , "../dataS/data.csv", row.names = FALSE)
# assemblage
noms <- list.files("../data/",pattern = ".csv")
data <- NULL
i <- 1
for (i in 1:length(noms)){
tmp <- read.csv(paste0("../data/",noms [i]), skip = 3, header = FALSE, fill = TRUE)
# impossible d'importer la ligne de titre (accent de année)
data <- rbind(data,tmp)
}
names(data) <-  c("dpt", "surface", "culture","S", "annee")
data <- data [,-4]
# le champs S pas nécessaire
# champs culture
code <- sort(table(data$culture))
knitr::kable(code)
data [grep ("CORSE",data$dpt),]
write.csv(data , "../dataS/data.csv", row.names = FALSE)
write.csv(data , "../dataS/data.csv", row.names = FALSE)
# jointure dpt : on récupère le numéro du dpt
data$INSEE_DEP <- substring(data$dpt, 1,2)
jointure <- merge(dpt, data, by = "INSEE_DEP")
# Enregistrement en format .gpkg 558 obs
st_write(jointure, "../dataS/data.gpkg", "jointure", row.names = FALSE,quiet = TRUE, delete_layer = TRUE)
setdiff(dpt$INSEE_DEP, jointure$INSEE_DEP)
data <- st_read("../dataS/data.gpkg", "jointure", quiet = TRUE, stringsAsFactors = TRUE)
str(data)
data$annee <- as.factor(data$annee)
# on va utiliser les facteurs dans les boucles de carto
table(data$culture, data$an)
# couleurs pour cultures
lcouleurs <- list (OP = "orange.pal", OH = "sand.pal", BTH = "green.pal")
# trouver les couleurs correpsondant aux palettes
couleurs <- c("orange", "wheat", "green")
png(
"../img/distributions.png",
width = 800,
height = 800,
res = 100
)
levels(data$an)
levels(data$culture)
par(mfrow = c(2, 3))
# année
i <- levels(data$an)[1]
for (i in levels(data$an)) {
j <- levels(data$culture)[1]
num <- 1
for (j in levels(data$culture)){
sel <- data[ data$an == i& data$culture == j,]
hist(sel$surface,
main = paste0(
i," ",
j,
" - Nb obs : ",
nrow(sel)
) ,
xlab = "Surface (ha)",
ylab = "Fréquence",
col = couleurs[num],
border = NA)
# couleur par rapport culture
num <- num + 1
}
}
dev.off()
cartographier <- function(data) {
# année
i <- levels(data$an)[1]
for (i in levels(data$annee)) {
j <- levels(data$culture)[1]
num <- 1
for (j in levels(data$culture)) {
sel <- data[data$annee == i & data$culture == j,]
par(mar = c(0, 0, 1.2, 0))
#centrage sur l'ensemble de la France
ghostLayer(fr$geom, bg = "white")
choroLayer(
sel,
var =  "surface",
method = "jenks",
nclass = 5,
col = carto.pal(pal1 = lcouleurs [[num]], 5),
border = NA,
legend.title.cex = 0.6,
legend.values.cex = 0.5,
legend.title.txt = "Aire (ha)",
legend.border = "gray96",
legend.pos = "left",
add = TRUE
)
layoutLayer(
title = paste0(j, " - ", i),
tabtitle = TRUE,
theme = lcouleurs [[num]],
frame = FALSE,
postitle = "center",
author = "Arvalis, 2021",
sources = "Agreste, IGN"
)
plot(
dpt$geom,
col = NA,
lty = 3,
lwd = 1,
border = "gray96",
add = TRUE
)
num <- num + 1
}
}
}
culture <- "OP"
annee <- "2020"
cartoSansBoucle <- function(culture, annee) {
sel <- data[data$annee == annee & data$culture == culture,]
# parametres couleurs
colCulture <-  unlist(lcouleurs [culture]  )
#par(mar = c(0, 0, 1.2, 0))
#centrage sur l'ensemble de la France
ghostLayer(dpt$geom, bg = "white")
choroLayer(
sel,
var =  "surface",
method = "jenks",
nclass = 5,
col = carto.pal(pal1 = colCulture, 5),
border = NA,
legend.title.cex = 0.6,
legend.values.cex = 0.5,
legend.title.txt = "Aire (ha)",
legend.border = "gray96",
legend.pos = "left",
add = TRUE
)
layoutLayer(
title = paste0(culture, " - ", annee),
tabtitle = TRUE,
theme = colCulture,
frame = FALSE,
postitle = "center",
author = "Arvalis, 2021",
sources = "Agreste, IGN",
posscale = "bottomright",
horiz = TRUE
)
plot(
dpt$geom,
col = NA,
lty = 3,
lwd = 1,
border = "gray96",
add = TRUE
)
}
cartoSansBoucle("OP", "2020")
png(
paste0("../img/carto", ".png"),
width = 600 * 3,
height = 600 * 2,
res = 200
)
par(mfrow = c(2, 3))
cartographier(data)
dev.off()
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,0,1.2,0))
cartoSansBoucle(j, i)
dev.off()
}
}
for (i in levels(data$annee)) {
for (j in levels(data$culture)) {
sizes <- getFigDim(dpt, width = 3000, res = 500)
png(
paste0("../img/carto",i,"_",j, ".png"),
width = sizes [1],
height = sizes [2],
res = 500
)
par(mar = c(0,0,1.2,0))
cartoSansBoucle(j, i)
dev.off()
}
}
